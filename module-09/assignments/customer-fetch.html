<!--n01551519
    Rutwa Dave
    Assignment Module-09
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Customers</title>
</head>

<body>
    <table id="customersTable" border="2">
        <tr>
            <th>Customer ID</th>
            <th>Title</th>
            <th>Name</th>
            <th>Address</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Order ID</th>
            <th>Order Date</th>
            <th>Item Price</th>
            <th>Item Qty</th>
        </tr>
    </table>
    <ol id="customersTable"></ol>
    <script>
        const xhr = (url, method = `GET`) =>
            new Promise((resolve) => {
                const xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        resolve(this.responseXML);
                    }
                };
                xhttp.open(method, url);
                xhttp.send();
            });

        function stringToNode(html) {
            const template = document.createElement(`template`);
            html = html.trim();
            template.innerHTML = html;
            return template.content.firstChild;
        }

        function createCustomer(customer) {
            const content = `
        <tr>
            <td>${customer.custId}</td>
            <td>${customer.title}</td>
            <td>${customer.name}</td>
            <td>${customer.address}</td>
            <td>${customer.phone}</td>
            <td>${customer.email}</td>
            <td>${customer.orderId}</td>
            <td>${customer.orderDate}</td>
            <td>${customer.itemPrice}</td>
            <td>${customer.itemQty}</td>
        </tr>
        `;

            return stringToNode(content);
        }

        const parseCustomer = (customer) => {
            const custId = customer.getAttribute(`custID`);
            const title = customer.getElementsByTagName(`name`)[0].getAttribute(`title`);
            const name = customer.getElementsByTagName(`name`)[0].childNodes[0].nodeValue;
            const address = customer.getElementsByTagName(`address`)[0].childNodes[0].nodeValue;
            const phone = customer.getElementsByTagName(`phone`)[0].childNodes[0].nodeValue;
            const email = customer.getElementsByTagName(`email`)[0] ? customer.getElementsByTagName(`email`)[0].childNodes[0].nodeValue : 'Not Available';
            const orderId = customer.getElementsByTagName(`order`)[0].getAttribute(`orderID`);
            const orderDate = customer.getElementsByTagName(`orderDate`)[0].childNodes[0].nodeValue;
            const itemPrice = customer.getElementsByTagName(`itemPrice`)[0].childNodes[0].nodeValue;
            const itemQty = customer.getElementsByTagName(`itemQty`)[0].childNodes[0].nodeValue;
            return { custId, title, name, address, phone, email, orderId, orderDate, itemPrice, itemQty };
        }



        function displayData(xmlDoc) {

            const custTable = document.getElementById(`customersTable`);

            const customer = xmlDoc.getElementsByTagName(`customer`);

            for (let index = 0; index < customer.length; index++) {

                const element = customer[index];
                const parsedCustomer = parseCustomer(element);
                const customersElement = createCustomer(parsedCustomer);
                custTable.appendChild(customersElement);

            }

        }
        fetch("customers.xml", { method: 'GET' })
            .then((response) => response.text())
            .then((data) => new DOMParser().parseFromString(data, "text/xml"))
            .then(displayData);

    </script>
</body>

</html>