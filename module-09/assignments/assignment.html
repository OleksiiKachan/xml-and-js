<!DOCTYPE html>
<html>
    <head>
        <title>Assignment Solution</title>
        <style>
            #container>div{
                border:2px solid black;
                border-radius: 10px;
                display: inline-block;
                margin: 10px;
                padding: 10px;
            }
        </style>
    </head>
    <body>
        <div id="container"></div>

        <script>
            const xhr = (url, method = "GET") => {
                return new Promise(resolve => {
                    const xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function(){
                        if(this.readyState == 4 && this.status == 200){

                            resolve(this);
                            

                        }
                    }
                    xhttp.open(method, url);
                    xhttp.send();
                })
            }


            const displayData = (xmlDoc) => {
                const containerDiv = document.getElementById("container");

                const customers = xmlDoc.getElementsByTagName("customer");

                for(let customer of customers){
                    const templateString = 
                        `<div>
                            <h2>
                                ${customer.getElementsByTagName("name")[0].getAttribute("title")}
                                ${customer.getElementsByTagName("name")[0].childNodes[0].nodeValue}
                            </h2>
                            <h3>Contact Details:</h3>
                            <p>
                                Address:
                                ${customer.getElementsByTagName("address")[0].childNodes[0].nodeValue} 
                            </p>
                            <p>
                                Phone:
                                ${customer.getElementsByTagName("phone")[0].childNodes[0].nodeValue}
                            </p>
                            <p>
                                Email:
                                ${customer.getElementsByTagName("email")[0]?.childNodes[0]?.nodeValue || "Not provided"}
                            </p>
                            <h3>Orders:</h3>
                            <p>
                                Order ID: 
                                ${customer.getElementsByTagName("order")[0].getAttribute('orderID')}, 
                                Order Date: 
                                ${customer.getElementsByTagName("orderDate")[0].childNodes[0].nodeValue}
                            </p>
                            <p>
                                Item Quantity:
                                ${customer.getElementsByTagName("itemQty")[0].childNodes[0].nodeValue},
                                Item Price:
                                ${customer.getElementsByTagName("itemPrice")[0].childNodes[0].nodeValue}
                            </p>
                        </div>`;

                    const template = document.createElement('template');
                    template.innerHTML = templateString;
                    containerDiv.appendChild(template.content.firstChild);
                }
            }

            
            // xhr("./customers.xml").then( ({responseXML}) => displayData(responseXML));

            // fetch("./customers.xml").then(result => result.text()).then((data)=> {
            //     const parser = new DOMParser();
            //     const XMLDoc = parser.parseFromString(data, "text/xml")
            //     displayData(XMLDoc);
            // })

            (async()=> {
                const result = await fetch("./customers.xml");
                const data = await result.text();
                const parser = new DOMParser();
                const XMLDoc = parser.parseFromString(data, "text/xml");
                displayData(XMLDoc);
            })();
        </script>
    </body>
</html>