<html>
  <head>
    <title>List of Customers</title>
    <link rel="stylesheet" href="customer.css" />
  </head>
  <body>
    <table id="customerList">
      <thead>
        <tr>
          <th>Name</th>
          <th>Address</th>
          <th>Phone</th>
          <th>Email</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

    <script>
    const xhr = (url, method = "GET") =>
    new Promise((resolve) => {
    const xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
      if (this.readyState === 4 && this.status === 200) {
        resolve(this.responseXML);
      }
    };
    xhttp.open(method, url);
    xhttp.send();
  });


      function displayData(data) {
        const customers = data.getElementsByTagName("customer");

        for (let index = 0; index < customers.length; index++) {
          const name = customers[index].getElementsByTagName("name")[0].textContent;
          const address = customers[index].getElementsByTagName("address")[0].textContent;
          const phone = customers[index].getElementsByTagName("phone")[0].textContent;
          const email =
            customers[index].getElementsByTagName("email")[0]?.textContent ?? "N/A";

          let orderTable = "";
          const orders = customers[index].getElementsByTagName("orders")[0];
          if (orders) {
            orderTable = `
              <table>
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Order Date</th>
                    <th>Items</th>
                  </tr>
                </thead>
                <tbody>
            `;

            const order = orders.getElementsByTagName("order");
            for (let len = 0; len < order.length; len++) {
              const orderID = order[len].getAttribute("orderID");
              const orderDate = order[len].getElementsByTagName("orderDate")[0].textContent;
              const item = order[len].getElementsByTagName("item")[0];
              const itemPrice = item.getElementsByTagName("itemPrice")[0].textContent;
              const itemQty = item.getElementsByTagName("itemQty")[0].textContent;

              orderTable += `
                <tr>
                  <td>${orderID}</td>
                  <td>${orderDate}</td>
                  <td>
                    ${itemPrice} x ${itemQty}
                  </td>
                </tr>
              `;
            }
            orderTable += `
                </tbody>
              </table>
            `;
          }

          const customerRow = `
            <tr>
              <td>${name}</td>
              <td>${address}</td>
              <td>${phone}</td>
              <td>${email}</td>
            </tr>
            <tr>
              <td colspan="4">
                ${orderTable}
              </td>
            </tr>
          `;

          document.querySelector("#customerList tbody").innerHTML += customerRow;
        }
      }

      xhr("customers.xml").then((data) => displayData(data))
    </script>
  </body>
</html>