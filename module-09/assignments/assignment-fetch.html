<!DOCTYPE html>
<html lang="en">
<head>
    <title>Assignment</title>
    <!-- Created By : Naitik Panchal -->
    <!-- N-No: N01512962 -->
    <style>
        table {
            border-collapse: collapse;
        }
        th,td {
            text-align: left;
            padding: 8px;
        }
        th {
            background-color: #fbd1d1;
        }
    </style>
</head>
<body>
    <h2>Module 9 - Assignment using fetch </h2>
    <table border="1" id="customersData">
        <tr>
            <th>Customer ID</th>
            <th>Name</th>
            <th>Address</th>
            <th>Phone</th>
            <th>email</th>
            <th>Order ID</th>
            <th>Order Date</th>
            <th>Item Price</th>
            <th>Item Quantity</th>
        </tr>
    </table>
    <script>
        const displayData = (xml) =>{
            const customers = xml.getElementsByTagName(`customer`);
            const custData = document.getElementById(`customersData`);
            console.log(custData);
            for(let index = 0; index < customers.length; index++){
                console.log(index);
                const customer = customers[index];
                const parsedCustomersData = parseData(customer);
                const tableData = createTable(parsedCustomersData);
                console.log("completed"+index);
                custData.appendChild(tableData);
            }
        }

        function stringToNode(content) {
            const template = document.createElement(`template`);
            const html = content.trim();
            template.innerHTML = html;
            return template.content.firstChild;
        }

        const parseData = (xml) => {

            // const customerID = xml.getElementsByTagName(`customer`)[0].getAttribute(`custID`);
            const customerID = xml.getAttribute(`custID`);
            const title = xml.getElementsByTagName(`name`)[0].getAttribute(`title`);
            const name = xml.getElementsByTagName(`name`)[0].childNodes[0].nodeValue;
            const address = xml.getElementsByTagName(`address`)[0].childNodes[0].nodeValue;
            const phone = xml.getElementsByTagName(`phone`)[0].childNodes[0].nodeValue;
            const email = xml.getElementsByTagName(`email`)[0] ? xml.getElementsByTagName(`email`)[0].childNodes[0].nodeValue:'N/A';
            const orderID = xml.getElementsByTagName(`order`)[0].getAttribute(`orderID`);
            const orderDate = xml.getElementsByTagName(`orderDate`)[0].childNodes[0].nodeValue;
            const itemPrice = xml.getElementsByTagName(`itemPrice`)[0].childNodes[0].nodeValue;
            const itemQuantity = xml.getElementsByTagName(`itemQty`)[0].childNodes[0].nodeValue;
            console.log(xml);
            return {customerID, title, name, address, phone, email, orderID, orderDate, itemPrice, itemQuantity};
        }

        const createTable = (customer) => {
            const content = `<tr>
                <td>${customer.customerID}</td>
                <td>${customer.title} ${customer.name}</td>
                <td>${customer.address}</td>
                <td>${customer.phone}</td>
                <td>${customer.email}</td>
                <td>${customer.orderID}</td>
                <td>${customer.orderDate}</td>
                <td>${customer.itemPrice}</td>
                <td>${customer.itemQuantity}</td>
            </tr>`;
            return stringToNode(content);
        }

        fetch("customers.xml", {method:'GET'})
        .then((result) => result.text())
        .then((strData) => new DOMParser().parseFromString(strData, "text/xml"))
        .then(displayData);

    </script>
</body>
</html>