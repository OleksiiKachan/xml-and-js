<!DOCTYPE html>
<html lang="en">
  <body>
    <ol id="customers"></ol>
    <script>
      const xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          displayData(this.responseXML);
        }
      };
      xhttp.open("GET", "customers.xml", true);
      xhttp.send();

      function stringToNode(html) {
        const template = document.createElement(`template`);
        html = html.trim();
        template.innerHTML = html;
        return template.content.firstChild;
      }

      function createCustomerInfo(customer) {
        const content = `<li>
  <article>
    <div>${customer.id}</div>
    <h2>${customer.title} ${customer.name}</h2>
    <div>${customer.address}</div>
    <div>${customer.phone}</div>
    <div>${customer.email}</div>
    <h4>OrderID: ${customer.orderID}</h4>
    <h4>OrderBy: ${customer.orderBy}</h4>
    <h4>OrderDate: ${customer.orderDate}</h4>
    <div>Item price: ${customer.itemPrice}</div>
    <div>Item quamtity: ${customer.itemQty}</div>
    <br>
  </article>
</li>`;

        return stringToNode(content);
      }

      function parseInfo(xml) {
        const id =
          xml.getAttribute(`custID`)
        const title =
          xml.getElementsByTagName(`name`)[0].getAttribute("title");
        const name =
          xml.getElementsByTagName(`name`)[0].childNodes[0].nodeValue;
        const address =
          xml.getElementsByTagName(`address`)[0].childNodes[0].nodeValue;
        const phone =
          xml.getElementsByTagName(`phone`)[0].childNodes[0].nodeValue;

          try{
            var email =
              xml.getElementsByTagName(`email`)[0].childNodes[0].nodeValue;
          }
          catch (error){
            var email = "No email address"
          }


        const orderID =
          xml.getElementsByTagName(`order`)[0].getAttribute("orderID");
        const orderBy =
          xml.getElementsByTagName(`order`)[0].getAttribute("orderBy");
        const orderDate =
          xml.getElementsByTagName(`orderDate`)[0].childNodes[0].nodeValue;
        const itemPrice =
          xml.getElementsByTagName(`itemPrice`)[0].childNodes[0].nodeValue;
        const itemQty =
          xml.getElementsByTagName(`itemQty`)[0].childNodes[0].nodeValue;


        return {
          id,
          title,
          name,
          address,
          phone,
          email,
          orderID,
          orderBy,
          orderDate,
          itemPrice,
          itemQty

        };

      }

      function displayData(xmlDoc) {

        const customers = xmlDoc.getElementsByTagName(`customer`);
        const list1 = document.getElementById(`customers`);
        for (let index1 = 0; index1 < customers.length; index1++) {
          const element = customers[index1];
          const parsedCustomer = parseInfo(element);
          const customerElement = createCustomerInfo(parsedCustomer);
          list1.appendChild(customerElement);

        }
      }
    </script>
  </body>
</html>
