<!DOCTYPE html>
<html>
  <head>
    <title>XML Table</title>
  </head>

  <body>
    <div id="xml-table"></div>

    <script>
      const xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          displayData(this);
        }
      };
      xhttp.open("GET", "stockMarket.xml", true);
      xhttp.send();

      function displayData(xml) {
        const xmlDoc = xml.responseXML;
        var table =
          "<table border='7' cellspacing='5'><tr><th>ID</th><th>Name</th><th>Currency</th><th>Address</th><th>Stock</th><th>Account</th></tr>"; /*<th>Sector</th><th>Industry</th><th>Market Cap</th><th>Price</th><th>First Name</th><th>Last Name</th><th>Gender</th><th>Occupation</th><th>IBAN</th></tr>";*/
        var records = xmlDoc.getElementsByTagName("record");
        for (var i = 0; i < records.length; i++) {
          var id =
            records[i].getElementsByTagName("id")[0].childNodes[0].nodeValue;
          var name =
            records[i].getElementsByTagName("name")[0].childNodes[0].nodeValue;
          var currency =
            records[i].getElementsByTagName("currency")[0].childNodes[0]
              .nodeValue;
          var street =
            records[i].getElementsByTagName("street")[0].childNodes[0]
              .nodeValue;
          var city =
            records[i].getElementsByTagName("city")[0].childNodes[0].nodeValue;
          var region =
            records[i].getElementsByTagName("region")[0].childNodes[0]
              .nodeValue;
          var country =
            records[i].getElementsByTagName("country")[0].childNodes[0]
              .nodeValue;

          let stocks = records[i].getElementsByTagName("stocks");
          console.log(stocks.length);
          let stocksHtml = "";
          for (let j = 0; j < stocks.length; j++) {
            let symbol =
              stocks[j].getElementsByTagName("symbol")[0].textContent;
            let stockName =
              stocks[j].getElementsByTagName("name")[0].textContent;
            let sector =
              stocks[j].getElementsByTagName("sector")[0].textContent;
            let industry =
              stocks[j].getElementsByTagName("industry")[0].textContent;
            let marketCap =
              stocks[j].getElementsByTagName("marketCap")[0].textContent;
            let price = stocks[j].getElementsByTagName("price")[0].textContent;
            stocksHtml += `
					<table border='5' cellspacing = '8' margin='20'>
						<tr>
							<th>Symbol</th>
							<th>Stock Name</th>
							<th>Sector</th>
							<th>Industry</th>
							<th>MarketCap</th>
							<th>Price</th>
						</tr>
						<tr>
							<td>${symbol}</td>
							<td>${stockName}</td>
							<td>${sector}</td>
							<td>${industry}</td>
							<td>${marketCap}</td>
							<td>${price}</td>
						</tr>
					</table>
					`;
          }
          let accounts = records[i].getElementsByTagName("accounts");
          let accountsHtml = "";
          for (let k = 0; k < accounts.length; k++) {
            let firstName =
              accounts[k].getElementsByTagName("firstName")[0].textContent;
            let lastName =
              accounts[k].getElementsByTagName("lastName")[0].textContent;
            let gender =
              accounts[k].getElementsByTagName("gender")[0].textContent;
            let occupation =
              accounts[k].getElementsByTagName("occupation")[0].textContent;
            let iban = accounts[k].getElementsByTagName("iban")[0].textContent;
            accountsHtml += `
              <li>
                Name: ${firstName} ${lastName}<br>
                Gender: ${gender}<br>
                Occupation: ${occupation}<br>
                IBAN: ${iban}<br><br>
              </li>
			  
	    `;
          }

          /*var symbol = records[i].getElementsByTagName("symbol")[0].childNodes[0].nodeValue;
				var stockName = records[i].getElementsByTagName("name")[1].childNodes[0].nodeValue;
				var sector = records[i].getElementsByTagName("sector")[0].childNodes[0].nodeValue;
				var industry = records[i].getElementsByTagName("industry")[0].childNodes[0].nodeValue;
				var marketCap = records[i].getElementsByTagName("marketCap")[0].childNodes[0].nodeValue;
				var price = records[i].getElementsByTagName("price")[0].childNodes[0].nodeValue;
				var firstName = records[i].getElementsByTagName("firstName")[0].childNodes[0].nodeValue;
				var lastName = records[i].getElementsByTagName("lastName")[0].childNodes[0].nodeValue;
				var gender = records[i].getElementsByTagName("gender")[0].childNodes[0].nodeValue;
				var occupation = records[i].getElementsByTagName("occupation")[0].childNodes[0].nodeValue;
				var iban = records[i].getElementsByTagName("iban")[0].childNodes[0].nodeValue;*/
          table +=
            "<tr><td>" +
            id +
            "</td><td>" +
            name +
            "</td><td>" +
            currency +
            "</td><td>" +
            street +
            "," +
            city +
            "\n" +
            region +
            "," +
            country +
            "</td><td>" +
            stocksHtml +
            "</td><td>" +
            accountsHtml +
            "</td></tr>"; /*"</td><td>" + symbol + "</td><td>" + stockName + "</td><td>" + sector + "</td><td>" + industry + "</td><td>" + marketCap + "</td><td>" + price + "</td><td>" + firstName + "</td><td>" + lastName + "</td><td>" + gender + "</td><td>" + occupation + "</td><td>" + iban + "</td></tr>";*/
        }
        table += "</table>";
        document.getElementById("xml-table").innerHTML = table;
      }
    </script>
  </body>
</html>
