<!DOCTYPE html>
<html>

<head>
    <title>Clinic</title>
    <style>
        h1{
            font-family: calibri;
            font-weight: bold;
            font-size: 50px;
        }
        p{
            font-family: calibri;
        }
        #cid,#add{
            margin-left:45px;
        }
        li{
            list-style-type: none;
            padding: 5px;
            margin-bottom: 5px;
            width: 40%;
            border: 1px solid black;
            border-radius: 8%;
            background-color: lightgoldenrodyellow;
            }
        article{
            display: flex;
            flex-direction: column;
            width:80%;
            border: 1px solid black;
            border-radius: 10%;
            padding-left: 10px;
            align-items: center;    
        }
        #emp{
            width:40%;
            margin-left:30px;
            margin-bottom: 5px;
        }
        h3{
            margin:0;
            padding:0;
            font-family: cambria;
            font-size: 24px;
            display: flex;
            align-items: center;
        }
    </style>
</head>

<body>
    <h1>Clinics</h1>
    <ol id="clinics"></ol>
    <script>
        const xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                displayData(this.responseXML);
            }
        };
        xhttp.open("GET", "clinic.xml", true);
        xhttp.send();

        function stringToNode(html) {
            const template = document.createElement(`template`);
            html = html.trim();
            template.innerHTML = html;
            return template.content.firstChild;
        }


        function createClinic(clinic) {
            console.log(clinic)
            const content =

                `<li>
                    <artcile>
                        <p id="cid">${clinic.id}</p>
                        <p id="add">Address: ${clinic.address}</p>
                        <article id="emp">
                            <h3>Employees</h3>
                            <p>${clinic.emp}</p>
                        </article>

                        <article>
                            <h3>Drugs</h3>
                            <p>${clinic.drug}</p>
                        </article>

                    </article>
                    </li>`;

            return stringToNode(content);
        }

        function parseClinic(xml) {

            const id = xml.getAttribute(`id`);
            const address = xml.getElementsByTagName(`street`)[0].childNodes[0].nodeValue + "," + xml.getElementsByTagName(`city`)[0].childNodes[0].nodeValue + "," + xml.getElementsByTagName(`region`)[0].childNodes[0].nodeValue + "," + xml.getElementsByTagName(`country`)[0].childNodes[0].nodeValue;
            var emp = "";
            for (let index = 0; index < xml.getElementsByTagName(`employee`).length; index++) {
                var emp = emp + xml.getElementsByTagName(`firstName`)[index].childNodes[0].nodeValue + " " + xml.getElementsByTagName(`lastName`)[index].childNodes[0].nodeValue + " - " + xml.getElementsByTagName(`empType`)[index].childNodes[0].nodeValue + "<br>";
            }

            var drug = "";

            for (let index = 0; index < xml.getElementsByTagName(`drug`).length; index++) {
                var drug = drug +
                    "Manufacturer: " +xml.getElementsByTagName(`manufacturer`)[index].childNodes[0].nodeValue + "<br>" +
                    "Brand: " + xml.getElementsByTagName(`brand`)[index].childNodes[0].nodeValue + "<br>" +
                    "Name: " + xml.getElementsByTagName(`name`)[index].childNodes[0].nodeValue + "<br>" +
                    "Code: " + xml.getElementsByTagName(`code`)[index].childNodes[0].nodeValue + "<br>" +
                    "Diagnosis Code: " + xml.getElementsByTagName(`diagnosisCode`)[index].childNodes[0].nodeValue + "<br>" +
                    "Description: " + xml.getElementsByTagName(`diagnosisDescription`)[index].childNodes[0].nodeValue + "<br>" +
                    "Quantity: " +xml.getElementsByTagName(`qty`)[index].childNodes[0].nodeValue + "<br><br>";
            }
            return { id, address, emp, drug };

        }


        function displayData(xmlDoc) {
            const clinics = xmlDoc.getElementsByTagName(`clinic`);
            let id = clinics[0].getAttribute("id");

            const list = document.getElementById(`clinics`);

            for (let index = 0; index < clinics.length; index++) {
                const element = clinics[index];
                const parsedClinic = parseClinic(element);
                const clinicElement = createClinic(parsedClinic);
                list.appendChild(clinicElement);
            }
        }

    </script>
</body>

</html>